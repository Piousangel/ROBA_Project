<html>
<head>
    <title>제목</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Menu_Select_Blending.css') }}">
</head>

<body onload="init();" oncontextmenu='return false' onselectstart='return false' ondragstart='return false'>
    <div id="wrap">
        <div class="menu_select">
            <p id="text_choice_bean" class="font_50">원두 종류 선택</p>
            <p id="text_sort" class="font_40_red">정렬</p>
            <div class="radio">
                <div id="sort_0" class="z-top">
                    <img hidden="hidden" class="img_relative" name="sort_0_selected" src="/static/imgs/ROBA_2-1_sweet_selected.png">
                    <img hidden="hidden" class="img_relative" name="sort_0_unselected" src="/static/imgs/ROBA_2-1_sweet_unselected.png">
                </div>
                <div id="sort_1" class="z-top">
                    <img hidden="hidden" class="img_relative" name="sort_1_selected" src="/static/imgs/ROBA_2-1_body_selected.png">
                    <img hidden="hidden" class="img_relative" name="sort_1_unselected" src="/static/imgs/ROBA_2-1_body_unselected.png">
                </div>
                <div id="sort_2" class="z-top">
                    <img hidden="hidden" class="img_relative" name="sort_2_selected" src="/static/imgs/ROBA_2-1_sour_selected.png">
                    <img hidden="hidden" class="img_relative" name="sort_2_unselected" src="/static/imgs/ROBA_2-1_sour_unselected.png">
                </div>
            </div>
        </div>


        <img id="img_description_0" class="description" src="/static/imgs/lostaric_img.png"  alt="description_0" />
        <img id="img_description_1" class="description" src="/static/imgs/terasosa_img.png"  alt="description_1" />
        <img id="img_description_2" class="description" src="/static/imgs/indonisia_img.png" alt="description_2" />

        <img id="img_backarrow" onclick="goBack()" src="/static/imgs/ROBA_23_backArrow.png" alt="logo" />
        <img id="img_line" src="/static/imgs/ROBA_2-1_bgLine.png" alt="logo"/>

        <p id="text_americano_kor" class="font_60">아메리카노</p>
        <p id="text_americano_eng" class="font_40">Americano</p>

        <div id="div_remain_box">
            <img src="/static/imgs/ROBA_2-1_ratioBG.png" id="_ratio" alt="alt">
            <p id="text_remain_text" class="font_30_red" name="remain_font">남은 비율:</p>
            <p id="text_remain_ratio" class="font_30_red" name="remain_ratio">100%</p>
        </div>

        <p id="text_blender_0" class="font_40">로스터릭 코스타리카 허니</p>
        <p id="text_blender_1" class="font_40">테라로사 에티오피아</p>
        <p id="text_blender_2" class="font_40">인도네시아 만델링</p>

        <img id="img_blender_0_cup" src="/static/imgs/ROBA_2-1_beaker_filled_lightBrown.png" alt="logo0" />
        <img id="img_blender_1_cup" src="/static/imgs/ROBA_2-1_beaker_filled_brown.png" alt="logo1"/>
        <img id="img_blender_2_cup" src="/static/imgs/ROBA_2-1_beaker_3.png" alt="logo2"/>

        <div class="img_blender_0_bg">
            <img id="img_blender_0_arrow" src="/static/imgs/ROBA_2-1_ratioBtn.png" alt="logo"/>
            <p id="text_blender_0_percent" class="percent font_60">{{blender_1}}%</p>
            <p id="blender_0_down" class="btn_down"></p>
            <p id="blender_0_up"   class="btn_up"  ></p>
        </div>
        <div class="img_blender_1_bg">
            <img id="img_blender_1_arrow" src="/static/imgs/ROBA_2-1_ratioBtn.png" alt="logo"/>
            <p id="text_blender_1_percent" class="percent font_60">{{blender_2}}%</p>
            <p id="blender_1_down" class="btn_down"></p>
            <p id="blender_1_up"   class="btn_up"  ></p>
        </div>
        <div class="img_blender_2_bg">
            <img id="img_blender_2_arrow" src="/static/imgs/ROBA_2-1_ratioBtn.png" alt="logo"/>
            <p id="text_blender_2_percent" class="percent font_60">{{blender_3}}%</p>
            <p id="blender_2_down" class="btn_down"></p>
            <p id="blender_2_up"   class="btn_up"  ></p>
        </div>
    </div>

    <img hidden="hidden" class="order" name="img_not_yet" src="/static/imgs/ROBA_2-2_선택완료_notyet.png">
    <img hidden="hidden" class="order" name="img_yet" src="/static/imgs/ROBA_2_button.png" onclick="orderform()">

    </div>
    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
        var sort_0 = [window.document.sort_0_unselected, window.document.sort_0_selected];
        var sort_1 = [window.document.sort_1_unselected, window.document.sort_1_selected];
        var sort_2 = [window.document.sort_2_unselected, window.document.sort_2_selected];

        var losvalue  = parseInt(document.getElementById("text_blender_0_percent").innerText);
        var teravalue = parseInt(document.getElementById("text_blender_1_percent").innerText);
        var indovalue = parseInt(document.getElementById("text_blender_2_percent").innerText);
        var remain_ratio = 100 - losvalue - teravalue - indovalue;

        var btn = [window.document.img_not_yet, window.document.img_yet]

        function init() {
            img_hide(sort_0);
            img_hide(sort_1);
            img_hide(sort_2);
            img_hide(btn);

            sort_0[0].hidden = false;
            sort_1[1].hidden = false;
            sort_2[0].hidden = false;

            btn[0].hidden = false;

            var radio = [document.getElementById("sort_0"), document.getElementById("sort_1"), document.getElementById("sort_2")];

            for (let i = 0; i < radio.length; i++) {
                radio[i].addEventListener("mousedown", function () {
                    sort_change(i)
                })
            }

            var ratio = [[document.getElementById("blender_0_up"), document.getElementById("blender_0_down")],
            [document.getElementById("blender_1_up"), document.getElementById("blender_1_down")],
            [document.getElementById("blender_2_up"), document.getElementById("blender_2_down")]]

            for (let blender = 0; blender < ratio.length; blender++) {
                for (let btn_ud = 0; btn_ud < ratio[0].length; btn_ud++) {
                    ratio[blender][btn_ud].addEventListener("mousedown", function () {
                        ratio_change(blender, btn_ud)
                    });
                }
            }

            document.getElementById("text_remain_ratio").innerText = remain_ratio.toString() + "%";

            if (remain_ratio == 0) {
                img_hide(btn);
                btn[1].hidden = false;
            }
        }

        function ratio_change(blender, btn_ud) {
            if (btn_ud == 0) {
                ratio_up(blender);
            } else {
                ratio_down(blender);
            }
        }

        function ratio_down(value) {
            if (value == 0) {
                if (losvalue != '0') {
                    losvalue -= 10;
                    remain_ratio += 10;
                }
            } else if (value == '1') {
                if (teravalue != 0) {
                    teravalue -= 10;
                    remain_ratio += 10;
                }
            } else if (value == '2') {
                if (indovalue != 0) {
                    indovalue -= 10;
                    remain_ratio += 10;
                }
            }

            if (remain_ratio != 0) {
                img_hide(btn);
                btn[0].hidden = false;
            }
            document.getElementById("text_blender_0_percent").innerText = losvalue.toString() + "%";
            document.getElementById("text_blender_1_percent").innerText = teravalue.toString() + "%";
            document.getElementById("text_blender_2_percent").innerText = indovalue.toString() + "%";
            document.getElementById("text_remain_ratio").innerText = remain_ratio.toString() + "%";
        }

        function ratio_up(value) {
            if (remain_ratio != 0) {
                if (value == '0') {
                    if (losvalue != 100) {
                        losvalue += 10;
                        remain_ratio -= 10;
                    }
                } else if (value == '1') {
                    if (teravalue != 100) {
                        teravalue += 10;
                        remain_ratio -= 10;
                    }
                } else if (value == '2') {
                    if (indovalue != 100) {
                        indovalue += 10;
                        remain_ratio -= 10;
                    }
                }
            }

            if (remain_ratio == 0) {
                img_hide(btn);
                btn[1].hidden = false;
            }
            document.getElementById("text_blender_0_percent").innerText = losvalue.toString() + "%";
            document.getElementById("text_blender_1_percent").innerText = teravalue.toString() + "%";
            document.getElementById("text_blender_2_percent").innerText = indovalue.toString() + "%";
            document.getElementById("text_remain_ratio").innerText = remain_ratio.toString() + "%";
        }

        function img_hide(array) {
            for (var i = 0; i < array.length; i++) {
                array[i].hidden = true;
            }
        }

        function sort_change(value) {
            console.log(value)
            img_hide(sort_0);
            img_hide(sort_1);
            img_hide(sort_2);
            if (value == '0') {
                sort_0[1].hidden = false;
                sort_1[0].hidden = false;
                sort_2[0].hidden = false;
                $("#img_description_0").animate({top: 660}, 1000);
                $("#img_description_1").animate({top: 850}, 1000);
                $("#img_description_2").animate({top: 480}, 1000);
            } else if (value == '1') {
                sort_0[0].hidden = false;
                sort_1[1].hidden = false;
                sort_2[0].hidden = false;
                $("#img_description_0").animate({top: 480}, 1000);
                $("#img_description_1").animate({top: 660}, 1000);
                $("#img_description_2").animate({top: 850}, 1000);
            } else {
                sort_0[0].hidden = false;
                sort_1[0].hidden = false;
                sort_2[1].hidden = false;
                $("#img_description_0").animate({top: 840}, 1000);
                $("#img_description_1").animate({top: 480}, 1000);
                $("#img_description_2").animate({top: 660}, 1000);
            }
        }

        function goBack() {
            sendGet("/Main");
        }

        function sendGet(action) {
            var form = document.createElement('form');
            form.setAttribute('method', 'get');
            form.setAttribute('action', action);
            document.charset = "utf-8";
            var hiddenField = document.createElement('input');
            hiddenField.setAttribute('type', 'hidden');
            form.appendChild(hiddenField);
            document
                .body
                .appendChild(form);
            form.submit();
        }

        var timeT = document.getElementById("runningtime");/*window.onload = function()
{
cnt = 10;
//countdown();
}    function countdown()
{
if(cnt == 0)
{
    sendPost('/Order_Timeout');
}
else{
timeT.innerText = cnt;
setTimeout("countdown()", 1000);
cnt--;
}
}*/
        function orderform() {
            var json = {
                "Blender_1": losvalue.toString(),
                "Blender_2": teravalue.toString(),
                "Blender_3": indovalue.toString()
            };
            sendPost("/Menu_Select_Blending", json);
        }
        function sendPost(action, params) {
            var form = document.createElement('form');
            form.setAttribute('method', 'post');
            form.setAttribute('action', action);
            document.charset = "utf-8";
            for (var key in params) {
                var hiddenField = document.createElement('input');
                hiddenField.setAttribute('type', 'hidden');
                hiddenField.setAttribute('name', key);
                hiddenField.setAttribute('value', params[key]);
                form.appendChild(hiddenField);
            }
            document
                .body
                .appendChild(form);
            form.submit();
        }
    </script>
</body>
</html>