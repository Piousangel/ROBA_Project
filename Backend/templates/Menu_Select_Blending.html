<html>

<head>
    <title>제목</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Menu_Select_Blending.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>

<body onload="init();" oncontextmenu='return false' onselectstart='return false' ondragstart='return false'>
    <div id="wrap">
        <div class="menu_select">
            <p id="text_choice_bean" class="font_50">원두 조합 선택</p>
        </div>

        <img id="img_description_0" class="description" src="/static/imgs/lostaric_img.png" alt="description_0" />
        <img id="img_description_1" class="description" src="/static/imgs/terasosa_img.png" alt="description_1" />
        <img id="img_description_2" class="description" src="/static/imgs/indonisia_img.png" alt="description_2" />

        <P id="text_recommend_ratio" class="font_40_red">추천 비율</P>
        <div class="img_recommend_btn">
            <div id="img_recommend_btn_0">
                <img hidden id="img_recommend_btn_0_select" class="img_relative"
                    src="/static/imgs/ROBA_2-1_newBtnBG.png">
                <img hidden id="img_recommend_btn_0_unselect" class="img_relative"
                    src="/static/imgs/ROBA_2-1_newBtnBG_pushed.png">
                <P class="text_recommend_btn font_40_red">산미<br>블렌드</P>
                <P class="text_recommend_btn_ratio font_25_yellow">50/20/30</P>
            </div>
            <div id="img_recommend_btn_1">
                <img hidden id="img_recommend_btn_1_select" class="img_relative"
                    src="/static/imgs/ROBA_2-1_newBtnBG.png">
                <img hidden id="img_recommend_btn_1_unselect" class="img_relative"
                    src="/static/imgs/ROBA_2-1_newBtnBG_pushed.png">
                <P class="text_recommend_btn font_40_red">바디감<br>블렌드</P>
                <P class="text_recommend_btn_ratio font_25_yellow">30/40/30</P>
            </div>
            <div id="img_recommend_btn_2">
                <img hidden id="img_recommend_btn_2_select" class="img_relative"
                    src="/static/imgs/ROBA_2-1_newBtnBG.png">
                <img hidden id="img_recommend_btn_2_unselect" class="img_relative"
                    src="/static/imgs/ROBA_2-1_newBtnBG_pushed.png">
                <P class="text_recommend_btn font_40_red">단맛<br>블렌드</P>
                <P class="text_recommend_btn_ratio font_25_yellow">40/20/40</P>
            </div>
        </div>


        <img id="img_backarrow" onclick="sendGet('/Main')" src="/static/imgs/ROBA_23_backArrow.png" alt="logo" />
        <img id="img_line" src="/static/imgs/ROBA_2-1_bgLine.png" alt="logo" />

        <p id="text_americano_kor" class="font_60">아메리카노</p>
        <p id="text_americano_eng" class="font_40">Americano</p>

        <div id="div_remain_box">
            <img src="/static/imgs/ROBA_2-1_leftRatioBG.png" id="_ratio" alt="alt">
            <p id="text_remain_text" class="font_30_red" name="remain_font">남은 비율:</p>
            <p id="text_remain_ratio" class="font_30_red" name="remain_ratio">100%</p>
        </div>


        <div id="div_blender_0" class="div_blender">
            <p class="text_blender font_40">원두0</p>
            <div class="img_blender_cup">
                <div id="img_blender_0_fill" class="img_blender_fill fill_normal"></div>
                <img class="img_relative" src="/static/imgs/ROBA_2-1_beaker_empty.png" alt="logo0" />
            </div>
            <div class="img_blender_bg blender_bg">
                <img class="img_blender_arrow" src="/static/imgs/ROBA_2-1_ratioBtn.png" alt="logo" />
                <p id="text_blender_0_percent" class="percent font_60">{{blender_1}}%</p>
                <p id="blender_0_down" class="btn_down"></p>
                <p id="blender_0_up" class="btn_up"></p>
            </div>
        </div>
        
        <div id="div_blender_1" class="div_blender">
            <p class="text_blender font_40">원두1</p>
            <div class="img_blender_cup">
                <div id="img_blender_1_fill" class="img_blender_fill  fill_dark"></div>
                <img class="img_relative" src="/static/imgs/ROBA_2-1_beaker_empty.png" alt="logo1" />
            </div>
            <div class="img_blender_bg blender_bg">
                <img class="img_blender_arrow" src="/static/imgs/ROBA_2-1_ratioBtn.png" alt="logo" />
                <p id="text_blender_1_percent" class="percent font_60">{{blender_2}}%</p>
                <p id="blender_1_down" class="btn_down"></p>
                <p id="blender_1_up" class="btn_up"></p>
            </div>
        </div>
        
        <div id="div_blender_2" class="div_blender">
            <p class="text_blender font_40">원두2</p>
            <div class="img_blender_cup">
                <div id="img_blender_2_fill" class="img_blender_fill fill_light"></div>
                <img class="img_relative" src="/static/imgs/ROBA_2-1_beaker_empty.png" alt="logo2" />
            </div>
            <div class="img_blender_bg blender_bg">
                <img class="img_blender_arrow" src="/static/imgs/ROBA_2-1_ratioBtn.png" alt="logo" />
                <p id="text_blender_2_percent" class="percent font_60">{{blender_3}}%</p>
                <p id="blender_2_down" class="btn_down"></p>
                <p id="blender_2_up" class="btn_up"></p>
            </div>
        </div>
        
        <div id="btn_order" class="order">
            <img hidden="hidden" class="img_relative" name="img_not_yet" src="/static/imgs/ROBA_2-2_선택완료_notyet.png">
            <img hidden="hidden" class="img_relative" name="img_yet" src="/static/imgs/ROBA_2_button.png">
            <img hidden="hidden" class="img_relative" name="img_pushed" src="/static/imgs/ROBA_2_button_pushed.png">
        </div>
    </div>
    
    </div>
   
    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
        var recommend = [[document.getElementById("img_recommend_btn_0_select"), document.getElementById("img_recommend_btn_0_unselect")], 
                         [document.getElementById("img_recommend_btn_1_select"), document.getElementById("img_recommend_btn_1_unselect")],
                         [document.getElementById("img_recommend_btn_2_select"), document.getElementById("img_recommend_btn_2_unselect")]];

        var losvalue = parseInt(document.getElementById("text_blender_0_percent").innerText);
        var teravalue = parseInt(document.getElementById("text_blender_1_percent").innerText);
        var indovalue = parseInt(document.getElementById("text_blender_2_percent").innerText);
        var remain_ratio = 100 - losvalue - teravalue - indovalue;

        var btn = [window.document.img_not_yet, window.document.img_yet, window.document.img_pushed]

        function init() {
            img_hide(recommend[0]);
            img_hide(recommend[1]);
            img_hide(recommend[2]);

            recommend[0][0].hidden = false;
            recommend[1][0].hidden = false;
            recommend[2][0].hidden = false;

            img_hide(btn);
            btn[0].hidden = false;

            var btn_recommend = [document.getElementById("img_recommend_btn_0"),
            document.getElementById("img_recommend_btn_1"),
            document.getElementById("img_recommend_btn_2")];

            for (let i = 0; i < btn_recommend.length; i++) {
                btn_recommend[i].addEventListener("mousedown", function () {
                    recommend_change(i)
                });
            }

            var ratio = [[document.getElementById("blender_0_up"), document.getElementById("blender_0_down")],
                         [document.getElementById("blender_1_up"), document.getElementById("blender_1_down")],
                         [document.getElementById("blender_2_up"), document.getElementById("blender_2_down")]];

            for (let blender = 0; blender < ratio.length; blender++) {
                for (let btn_ud = 0; btn_ud < ratio[0].length; btn_ud++) {
                    ratio[blender][btn_ud].addEventListener("mousedown", function () {
                        ratio_change(blender, btn_ud)
                    });
                }
            }

            document.getElementById("text_remain_ratio").innerText = remain_ratio.toString() + "%";

            if (remain_ratio == 0) {
                img_hide(btn);
                btn[1].hidden = false;
            }
            
            btn_order = document.getElementById("btn_order")
            btn_order.addEventListener("mousedown", function(){
                 
                if(remain_ratio == 0){ 
                    img_hide(btn);
                    btn[2].hidden=false;
                }
            })
            btn_order.addEventListener("mouseup", function(){
                if(remain_ratio == 0){ 
                    orderform();
                }
            })
            btn_order.addEventListener("mouseleave", function(){
                 
                if(remain_ratio == 0){ 
                    img_hide(btn);
                    btn[1].hidden=false;
                }
                else{
                    btn[0].hidden=false;
                }
            })

            fill_animation("img_blender_0_fill", losvalue);
            fill_animation("img_blender_1_fill", teravalue);
            fill_animation("img_blender_2_fill", indovalue);
        }

        function recommend_change(value) {
            
            img_hide(recommend[0]);
            img_hide(recommend[1]);
            img_hide(recommend[2]);
            if (value == 0) {
                losvalue = 50;
                teravalue = 20;
                indovalue = 30;
                remain_ratio = 0;
                recommend[0][1].hidden = false;
                recommend[1][0].hidden = false;
                recommend[2][0].hidden = false;
            } else if (value == '1') {
                losvalue = 30;
                teravalue = 40;
                indovalue = 30;
                remain_ratio = 0;
                recommend[0][0].hidden = false;
                recommend[1][1].hidden = false;
                recommend[2][0].hidden = false;
            } else if (value == '2') {
                losvalue = 40;
                teravalue = 20;
                indovalue = 40;
                remain_ratio = 0;
                recommend[0][0].hidden = false;
                recommend[1][0].hidden = false;
                recommend[2][1].hidden = false;
            }

            img_hide(btn);
            btn[1].hidden = false;

            document.getElementById("text_blender_0_percent").innerText = losvalue.toString() + "%";
            document.getElementById("text_blender_1_percent").innerText = teravalue.toString() + "%";
            document.getElementById("text_blender_2_percent").innerText = indovalue.toString() + "%";
            document.getElementById("text_remain_ratio").innerText = remain_ratio.toString() + "%";

            fill_animation("img_blender_0_fill", losvalue);
            fill_animation("img_blender_1_fill", teravalue);
            fill_animation("img_blender_2_fill", indovalue);
        }

        function ratio_change(blender, btn_ud) {
            if (btn_ud == 0) {
                ratio_up(blender);
            } else {
                ratio_down(blender);
            }
        }

        function ratio_down(value) {
            if (value == 0) {
                if (losvalue != '0') {
                    losvalue -= 10;
                    remain_ratio += 10;
                }
            } else if (value == '1') {
                if (teravalue != 0) {
                    teravalue -= 10;
                    remain_ratio += 10;
                }
            } else if (value == '2') {
                if (indovalue != 0) {
                    indovalue -= 10;
                    remain_ratio += 10;
                }
            }

            if (remain_ratio != 0) {
                img_hide(btn);
                btn[0].hidden = false;
            }
            document.getElementById("text_blender_0_percent").innerText = losvalue.toString() + "%";
            document.getElementById("text_blender_1_percent").innerText = teravalue.toString() + "%";
            document.getElementById("text_blender_2_percent").innerText = indovalue.toString() + "%";
            document.getElementById("text_remain_ratio").innerText = remain_ratio.toString() + "%";

            fill_animation("img_blender_0_fill", losvalue);
            fill_animation("img_blender_1_fill", teravalue);
            fill_animation("img_blender_2_fill", indovalue);
        }

        function ratio_up(value) {
            if (remain_ratio != 0) {
                if (value == '0') {
                    if (losvalue != 100) {
                        losvalue += 10;
                        remain_ratio -= 10;
                    }
                } else if (value == '1') {
                    if (teravalue != 100) {
                        teravalue += 10;
                        remain_ratio -= 10;
                    }
                } else if (value == '2') {
                    if (indovalue != 100) {
                        indovalue += 10;
                        remain_ratio -= 10;
                    }
                }
            }

            if (remain_ratio == 0) {
                img_hide(btn);
                btn[1].hidden = false;
            }
            document.getElementById("text_blender_0_percent").innerText = losvalue.toString() + "%";
            document.getElementById("text_blender_1_percent").innerText = teravalue.toString() + "%";
            document.getElementById("text_blender_2_percent").innerText = indovalue.toString() + "%";
            document.getElementById("text_remain_ratio").innerText = remain_ratio.toString() + "%";
            fill_animation("img_blender_0_fill", losvalue);
            fill_animation("img_blender_1_fill", teravalue);
            fill_animation("img_blender_2_fill", indovalue);
        }

        function img_hide(array) {
            for (var i = 0; i < array.length; i++) {
                array[i].hidden = true;
            }
        }

        function fill_animation(id, ratio) {
            id = '#' + id;
            var height_ratio = ratio * 1.2;
            var top_ratio = 132 - height_ratio;

            console.log(top_ratio);
            $(id).animate({ top: top_ratio, height: height_ratio }, 200);
        }
       

        /*function goBack() {
            sendGet("/Main");
        }*/

       

        var timeT = document.getElementById("runningtime");

        function orderform() {
            var json = {
                "Blender_1": losvalue.toString(),
                "Blender_2": teravalue.toString(),
                "Blender_3": indovalue.toString()
            };
            sendPost("/Menu_Select_Blending", json);
        }
        function sendPost(action, params) {
            var form = document.createElement('form');
            form.setAttribute('method', 'post');
            form.setAttribute('action', action);
            document.charset = "utf-8";
            for (var key in params) {
                var hiddenField = document.createElement('input');
                hiddenField.setAttribute('type', 'hidden');
                hiddenField.setAttribute('name', key);
                hiddenField.setAttribute('value', params[key]);
                form.appendChild(hiddenField);
            }
            document
                .body
                .appendChild(form);
            form.submit();
        }
    </script>
     <script src="/static/script/Common.js"></script>

</body>

</html>